<div class="card main-card" id="spots-form">
  @if (loading) {
    <h2> Chargement ... </h2>
    <img class="loading" alt="chargement" src="" style="margin: 2rem">
  }
  @if (error) {
    <h2> Erreur ! </h2>
    <div><span style="font-weight: 600;">{{ error }}</span><a href="{{ errorUrl }}">{{ errorUrl }}</a></div>
  }
  @if (session.Id) { <h2> Modifier session : {{ session.StartTime | date:'EEEE dd/MM/yyyy' | titlecase }} - {{ session.Spot.Name }}</h2> }
  @else if (!error && !loading) { <h2> Nouvelle session </h2> }

  <div class="form-div">
    <form #sessionForm="ngForm" (ngSubmit)="saveSession()">
      <div class="form-group spot"><label for="spot"><h4>Spot : </h4></label>
        <select id="spot" name="spotName" [(ngModel)]="session.Spot.Id" required>
          @for (spot of spots; track $index){
            <option [value]="spot.Id">{{ spot.Name }}</option>
          }
      </select></div>

      <div class="form-group date"><label for="date"><h4>Date : </h4></label>
      <input id="date" type="date" [(ngModel)]="date" name="date" required></div>

      <div class="form-group time"><label for="startTime"><h4>Heure de début : </h4></label>
      <input id="startTime" type="time" [(ngModel)]="startTime" name="startTime" required></div>

      <div class="form-group time"><label for="endTime"><h4>Heure de fin : </h4></label>
      <input id="endTime" type="time" [(ngModel)]="endTime" name="endTime" required></div>

      <div class="form-group comment"><label for="comment"><h4>Commentaire : </h4></label>
       <textarea id="comment" [(ngModel)]="this.session.Comment" name="comment" rows="4" cols="50" placeholder="Votre commentaire..."></textarea></div>

      <div class="form-group rating">
        <h4>Note : </h4>
        <div class="rating-div">
            @for (n of [1,2,3,4,5]; track $index){
                  <span (click)="this.session.Rating = n"
                        (mouseenter)="hover = n"
                        (mouseleave)="hover = 0"
                        [class.filled]="n <= (hover || this.session.Rating)">&#9733;</span>
            }
        </div>
      </div>

      <br><button type="submit" [disabled]="!sessionForm.form.valid">{{ session?.Id ? 'Modifier' : 'Créer' }}</button>

    </form>


    <div id='photos-div'>
      <h4>À venir : ajouter des photos à la sessions</h4>
      <img src="placeholder_image.png" alt="Image générique"/>
    </div>

  </div>
</div>

<style>
  @media (orientation: portrait) {
    form { width: 100% !important; padding: 0.4rem !important; }
    #photos-div { display: none !important; }
    h4, .form-group { margin: 0.4rem 0 !important }
    h4 ~ br { display: none }
    .form-group.comment { flex-direction: column !important; align-items: start !important; }
    textarea { width: 100% !important; margin-top: 0.45rem !important }
  }

  form { width: 60%; padding: 0 1rem 0 0; }
  #photos-div { width: 40%; display: flex; flex-direction: column; align-items: center; margin-top: 0; }

  .form-group {
    justify-content: start !important;
    align-items: center !important;
  }

  .rating-div span {
    font-size: 2rem;
    cursor: pointer;
    color: var(--background-color-blue-03);
  }

  .rating-div span.filled { color: gold; }
  img { width: 90%; margin-top: 1rem; border-radius: 10px;}
  .form-group:first-of-type { margin-top: 0 !important;}
  .rating-div{ margin-left: 1rem }
  textarea { width: 65% }
  #spot { width: 65% }

</style>
