<div class="card toolbar-card">
  <h2>Mes sessions :</h2>
  <button class="refreshBtn" (click)="refreshSessions($event)">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
  </button>
  <button class="newBtn" [routerLink]="['/session/form', 'new']">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><line x1="1" y1="12" x2="23" y2="12"></line></svg>
    <span>Nouvelle</span>
  </button>
</div>

@if (error || loading) {
  <div class="card main-card">
    @if (loading) {
      <h2> Chargement ... </h2>
      <img class="loading" alt="chargement" src="" style="margin: 2rem">
    }
    @if (error) {
      <h2> Erreur ! </h2>
      <div><span style="font-weight: 600;">{{ error }}</span><a href="{{ errorUrl }}">{{ errorUrl }}</a></div>
    }
  </div>
}

@for (session of this.sessions; track $index) {
  <div #sessionCard class="card session-card"><!-- [routerLink]="['/session/' + session.Id ] -->
    <h2>{{ session.StartTime | date:'EEEE dd/MM/yy' | titlecase }} - {{ session.Spot.Name }}</h2>
    <app-map [mapId]="'map-' + session.Id + session.Spot.Id" type="readonly" [lat]="session.Spot.Latitude" [lon]="session.Spot.Longitude" ></app-map>
    <div class="session-details">
      <p> Heure de d√©but : <b> {{ session.StartTime | date:'HH:mm'}} </b> </p>
      <p> Heure de fin : <b> {{ session.EndTime | date:'HH:mm'}} </b> </p>
       <div id="rating-group">Note :
          <div class="rating-div">
            @for (n of [1,2,3,4,5]; track $index){
              <span [class.filled]="n <= session.Rating">&#9733;</span>
            }
          </div>
        </div>
      <p> Commentaire : <b> {{ session.Comment }} </b> </p>
    </div>
    <div class="toolbar-card embbeded">
      <button class="editBtn" [routerLink]="['/session/form', session?.Id]">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
      </button>
      <button class="deleteBtn" (click)="deleteSession($event, session.Id)">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      </button>
    </div>
  </div>
}
<div class="spacer bottom"></div>

<style>

  .session-card {
    cursor: default;
  }

  #rating-group {
    display: flex;
    flex-direction: row;
    align-items: center;
  }

  .rating-div {
    margin-left: 0.4rem;
  }

  .rating-div span {
    line-height: 1;
    font-size: 1.6rem;
    color: var(--background-color-blue-03);
  }

  .rating-div span.filled { color: gold; }

  .toolbar-card.embbeded{
    min-width: 0 !important;
    margin: 0 !important;
    position: absolute;
    top: -0.2rem;    /* distance depuis le haut de la carte */
    right: -0.2rem;  /* distance depuis le bord droit */
    height: 2.8rem;
  }
</style>
